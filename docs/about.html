
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-05-17
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>TimeSeries in Oracle NoSQL database | xstream: TimeSeries + Oracle NoSQL + Apache Spark</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/spacelab/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />


		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<link rel="stylesheet" href="css/hybrid.css"/>
<script src="scripts/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
	</head>

	<body class="page-about project-xstream" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top navbar-inverse">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://sleepycat-tools:9000/www/xstream">xstream</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="./" id="bannerLeft"><img src="images/xstream_logo.png" alt='"'xStream'"' /></a>
					<p class="lead">xstream: TimeSeries + Oracle NoSQL + Apache Spark</p>
				</div>
				<div class="pull-right">
					<div id="bannerRight"><img src="images/nosql_logo.gif" alt='"''"' /></div>
				</div>
			</div>
		</div>
	</div>
		<div>
			<ul class="breadcrumb">
				<li class="publishDate version-date pull-right">Last Published: 2017-05-17</li>
				<li class="divider pull-right">|</li>
				<li class="projectVersion version-date pull-right">Version: 0.2</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="page-header">
 <h1 id="timeseries_in_oracle_nosql_database">TimeSeries in Oracle NoSQL database</h1>
</div> 
<p>A <b>timeSeries</b> is a sequence of events ordered by time. An <b>event</b> is any data with a timestamp.</p> 
<p>TimeSeries occurs in many data management scenarios in financial business, sensor data acquisition, system monitoring etc. </p> 
<div class="section"> 
 <h2 id="Storing_Timeseries">Storing Timeseries</h2> 
 <p>While storing events is not new, the need to collect and analyze massive amounts of sequenced, often unstructured data from thousands or more devices is a new and growing requirement for IoT.</p> 
 <p>We consider timeseries with following characteristics: + contains large number of events (could be hundreds of millions) + time is as essential dimension + events carry arbitrary properties and flexible in structure + the information content of events are more meaningful as aggregate than of an individual event. </p> 
 <div class="section"> 
  <h3 id="Storage_Layout">Storage Layout</h3> 
  <p>We use NoSQL database to store a timeseries. A timeseries corresponds to a database table where each row of the table represents a <i>time slot</i>.</p> 
  <p>A <i>slot</i> is a sequence of fixed number of events ordered by their timestamp. Each event has a set of properties which are defined at creation of the timeseries.</p> 
  <p>The layout of a table that represents a TimeSeries</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th align="left">Column </th> 
     <th align="left">Type </th> 
     <th align="left">Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td align="left"><b>SLOT_INDEX</b> </td> 
     <td align="left">INTEGER </td> 
     <td align="left">index of the slot (primary key)</td> 
    </tr> 
    <tr class="a"> 
     <td align="left">TIMESTAMPT_START </td> 
     <td align="left">LONG </td> 
     <td align="left">timestamp of first active event</td> 
    </tr> 
    <tr class="b"> 
     <td align="left">TIMESTAMP_END </td> 
     <td align="left">LONG </td> 
     <td align="left">timestamp of last active event</td> 
    </tr> 
    <tr class="a"> 
     <td align="left">EVENT_INDEX_OFFSET</td> 
     <td align="left">INTEGER </td> 
     <td align="left">index of first active event</td> 
    </tr> 
    <tr class="b"> 
     <td align="left">EVENT_INDEX_END </td> 
     <td align="left">INTEGER </td> 
     <td align="left">index of first active event</td> 
    </tr> 
    <tr class="a"> 
     <td align="left">EVENT_LIMIT </td> 
     <td align="left">INTEGER </td> 
     <td align="left">total number of events in a slot</td> 
    </tr> 
    <tr class="b"> 
     <td align="left">EVENTS </td> 
     <td align="left">ARRAY(RECORD)</td> 
     <td align="left">data as array of event </td> 
    </tr> 
   </tbody> 
  </table> 
  <p>However, such tables are managed by <tt>xstream</tt> and completely transparent to user application. </p> 
  <div class="section"> 
   <h4 id="Time_Slot">Time Slot</h4> 
   <p>A time slot is a sequence of events ordered by time. The event data of a slot plus metadata about the slot forms a row a <tt>timeseries</tt>. </p> 
   <p>The events in a slot are maintained as a array of records. Each element record of the array correspond to an event with timestamp. The fields of an event is determined by user application. An event can have any property, however, all events in a slot must have same structure.</p> 
   <p><b>Timerange</b> of a slot is the time interval <tt>(TIMESTAMPT_START, TIMESTAMPT_END)</tt></p> 
   <ul> 
    <li> <p><tt>SLOT_INDEX</tt> is used as primary key, but it is noteworthy that the events of the entire series are <i>not</i> ordered by slot index. In other words two slots indices <tt>i</tt> and <tt>j</tt> where <tt>j &gt; i</tt> does not necessarily imply the time range of <tt>j</tt> is after that of <tt>i</tt>.</p></li> 
    <li> <p>The time ranges of slots are not overlapping.</p></li> 
    <li> <p>A slot contains fixed number events, though individual events can vary in storage bytes. So slots can vary in their storage bytes.</p></li> 
   </ul> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Data_Locality">Data Locality</h3> 
  <p>The data locality is achieved through slot-based layout of a ’timeseries`.<br />Because a) the timestamp of events in a slot are monotonic and b) the time range of slots are non-overlapping.</p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Query">Query</h2> 
 <p>Apache Spark runs SQL queries on timeseries. The query syntax is same as the syntax supported by Apache Spark, except joining between two timeseries is not supported. </p> 
 <p>A timeseries persistent in Oracle NoSQL database is presented to Apache Spark framework as a <tt>TimeSeriesRDD</tt> (RDD stands for Resilient Distributed Dataset – the primary data abstraction used by Apache Spark for cluster computing). Each partition of <tt>TimeSeriesRDD</tt> corresponds to one or more slots of persistent timeseries. </p> 
 <p>Apache Spark can partition and distribute across distributes computation tasks across a clusters of machines and finally combine the results. Once timeseries data is made available as an RDD with partitions, Apache Spark evaluates any SQL query (including aggregate query) using same powerful cluster computing mechanism.</p> 
 <p>The following code snippet demonstrates how a persistent TimeSeries can be queried using Spark:</p> 
 <div class="source"> 
  <pre>	import xstream.spark.TimeseriesRDD;
	import org.apache.spark.sql.SparkSession;
	import org.apache.spark.sql.Row;
	// open a Spark Session in standard manner
    	SparkSession spark = ...                                
    	// use an URI for NoSQL persistent TimeSeries
	String url = &quot;nosql://localhost:5000/kvstore/traffic&quot;;  
	// create an RDD from a persistent TimeSeries
	TimeSeriesRDD = new TimeseriesRDD(spark, url);   
	// declare a SQL aggregate query       
    	String sqlText = &quot;select avg(speed) from &quot;              
                + rdd.getSeriesName()  + &quot;  where avg(speed) &gt; 70&quot;;
      // execute query for results as Spark Row          
    	Dataset&lt;Row&gt; rs = spark.executeQuery(sqlText);          

</pre> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#timeseries_in_oracle_nosql_database" title="TimeSeries in Oracle NoSQL database">TimeSeries in Oracle NoSQL database <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#Storing_Timeseries" title="Storing Timeseries">Storing Timeseries <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#Storage_Layout" title="Storage Layout">Storage Layout <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Time_Slot" title="Time Slot">Time Slot</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Data_Locality" title="Data Locality">Data Locality</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Query" title="Query">Query</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span4 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Home</li>
						<li class="active">
							<a href="#" title="Overview">Overview</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source Code">Source Code</a>
						</li>
						<li >
							<a href="dependencies.html" title="Dependencies">Dependencies</a>
						</li>
					</ul>
				</div>
				<div class="span5 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="apidocs/index.html" title="Java API">Java API</a>
						</li>
						<li >
							<a href="user_manual.html" title="User Manual">User Manual</a>
						</li>
						<li >
							<a href="ref_manual.html" title="Reference Manual">Reference Manual</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http::/www.oracle.com/">Oracle Corp.</a>. All Rights Reserved.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
